#include <8051.h> 
__code unsigned tone[36] =
{
	65536 - (1000000 / (262 * 2)), // C  0 
	65536 - (1000000 / (277 * 2)), // C# 1
	65536 - (1000000 / (294 * 2)), // D  2
	65536 - (1000000 / (311 * 2)), // D# 3
	65536 - (1000000 / (330 * 2)), // E  4
	65536 - (1000000 / (349 * 2)), // F  5
	65536 - (1000000 / (370 * 2)), // F# 6 
	65536 - (1000000 / (392 * 2)), // G  7
	65536 - (1000000 / (415 * 2)), // G# 8
	65536 - (1000000 / (440 * 2)), // A  9
	65536 - (1000000 / (466 * 2)), // A# 10
	65536 - (1000000 / (494 * 2)), // B  11

	65536 - (1000000 / (523 * 2)), // C  12
	65536 - (1000000 / (554 * 2)), // C# 13
	65536 - (1000000 / (587 * 2)), // D  14
	65536 - (1000000 / (622 * 2)), // D# 15 
	65536 - (1000000 / (659 * 2)), // E  16
	65536 - (1000000 / (698 * 2)), // F  17
	65536 - (1000000 / (740 * 2)), // F# 18
	65536 - (1000000 / (784 * 2)), // G  19
	65536 - (1000000 / (831 * 2)), // G# 20
	65536 - (1000000 / (880 * 2)), // A  21
	65536 - (1000000 / (932 * 2)), // A# 22
	65536 - (1000000 / (988 * 2)), // B  23

	65536 - (1000000 / (1046 * 2)), // C  24
	65536 - (1000000 / (1109 * 2)), // C# 25
	65536 - (1000000 / (1175 * 2)), // D  26
	65536 - (1000000 / (1245 * 2)), // D# 27
	65536 - (1000000 / (1318 * 2)), // E  28
	65536 - (1000000 / (1397 * 2)), // F  29
	65536 - (1000000 / (1480 * 2)), // F# 30
	65536 - (1000000 / (1568 * 2)), // G  31
	65536 - (1000000 / (1661 * 2)), // G# 32
	65536 - (1000000 / (1760 * 2)), // A  33
	65536 - (1000000 / (1865 * 2)), // A# 34
	65536 - (1000000 / (1976 * 2)), // B  35
};

#define TIMER_VAL 3036 //65536 - 62500 = 3036 HZ 跑50000是0.05秒 跑10000是0.01秒 要跑0.625秒就要10000*6.25= 62500
int count = 0;
int i = 0;

__code unsigned song[] = {
	
	23,23,23,  23,21,19,  19,18,16,
	16,19,23,  28,28,28,  28,26,24,
	
	24,23,21,  21,23,24,  23,24,23,
	27,24,23,  23,21,19,  19,17,16,
	18,18,18,  18,19,18,  16,16,16,16,
	
	20,20,20,  20,18,16,  16,15,15,
	15,15,15,  24,24,24,  24,26,24,	
	24,23,23,  23,24,26,  28,28,28,

	28,27,26,  25,25,25,  25,23,21,
	20,20,20,  20,21,18,  16,16,16,16
	

};



void timer_isr(void) __interrupt(1) __using(1)
{
	TH0 = TIMER_VAL >> 8;
	TL0 = TIMER_VAL & 0xff;
	count++;
}
void timer_isr2(void) __interrupt(3) __using(2)
{
	TH1 = tone[song[i]] >> 8;
	TL1 = tone[song[i]] & 0xff;
	if (tone[song[i]])
		P2 = ~P2;

}

void main()
{

	TMOD = 0x11;
	TH0 = TIMER_VAL >> 8;
	TL0 = TIMER_VAL & 0xff;
	TR0 = 1; // start Timer 0
	ET0 = 1; // enable Timer 0 overflow interrupt
	EA = 1; //enable all interrupt
	TR1 = 1;
	ET1 = 1;
	TH1 = tone[song[i]] >> 8;
	TL1 = tone[song[i]] & 0xff;


	while (1)
	{

		if (count == 10)
		{

			i++;
			if (i == 92)
				i = 0;
			count = 0;
			TH1 = tone[song[i]] >> 8;
			TL1 = tone[song[i]] & 0xff;
			
		}
	}
}
